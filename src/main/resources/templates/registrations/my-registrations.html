<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Event Registrations</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { margin-bottom: 30px; }
        .registration-card { background: white; padding: 25px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #764ba2; }
        .btn-feedback { background: #17a2b8; }
        .btn-feedback:hover { background: #138496; }
        .event-past { border-left: 4px solid #28a745; }
        .event-future { border-left: 4px solid #ffc107; }
        .search-box { background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>My Event Registrations</h1>
            <p>View your registered events and submit feedback</p>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <h3>Find Your Registrations</h3>
            <form th:action="@{/registrations/my-registrations}" method="get">
                <input type="email" name="email" placeholder="Enter your email address" required 
                       th:value="${email}" style="padding: 10px; width: 300px; margin-right: 10px;">
                <button type="submit" class="btn">Find My Registrations</button>
            </form>
        </div>

        <div th:if="${email != null}">
            <div th:if="${registrations.empty}">
                <p>No registrations found for <strong th:text="${email}"></strong>.</p>
                <p>Please check your email address or <a href="/events/list">register for an event</a> first.</p>
            </div>

            <div th:each="registration : ${registrations}" class="registration-card" 
                 th:classappend="${registration.event.eventDate.isBefore(T(java.time.LocalDateTime).now())} ? 'event-past' : 'event-future'">
                <h3 th:text="${registration.event.name}">Event Name</h3>
                <p><strong>Date:</strong> <span th:text="${#temporals.format(registration.event.eventDate, 'yyyy-MM-dd HH:mm')}"></span></p>
                <p><strong>Location:</strong> <span th:text="${registration.event.location}"></span></p>
                <p><strong>Registration Date:</strong> <span th:text="${#temporals.format(registration.registrationDate, 'yyyy-MM-dd HH:mm')}"></span></p>
                <p><strong>Status:</strong> <span th:text="${registration.status}"></span></p>
                
                <div class="actions">
                    <!-- Only show feedback button for past events -->
                    <a th:if="${registration.event.eventDate.isBefore(T(java.time.LocalDateTime).now()) && registration.status == 'REGISTERED'}" 
                       th:href="@{/feedback/submit/{eventId}(eventId=${registration.event.id})}" 
                       class="btn btn-feedback">
                        üìù Submit Feedback
                    </a>
                    <a th:href="@{/events/view/{id}(id=${registration.event.id})}" class="btn">
                        View Event Details
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>